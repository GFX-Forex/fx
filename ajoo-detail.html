<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Circle Details - Meritwise</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&display=swap');
        :root {
            --purple: #7c3aed; --purple-dark: #6d28d9; --purple-light: #ede9fe;
            --blue: #3b82f6; --green: #059669; --green-light: #dcfce7; --green-dark: #065f46;
            --red: #dc2626; --red-light: #fee2e2; --amber: #d97706; --amber-light: #fef3c7;
            --gray-900: #0f172a; --gray-600: #475569; --gray-400: #94a3b8; --gray-200: #e2e8f0; --gray-100: #f1f5f9;
            --white: #fff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Sora', sans-serif; background: var(--gray-100); padding-bottom: 100px; }
        .container { max-width: 480px; margin: 0 auto; }
        
        /* Header */
        .header { position: sticky; top: 0; z-index: 100; padding: 16px 20px; padding-top: max(20px, env(safe-area-inset-top, 20px)); background: rgba(241,245,249,0.92); backdrop-filter: blur(24px); display: flex; align-items: center; gap: 16px; border-bottom: 1px solid rgba(148,163,184,0.12); }
        .back-btn { width: 40px; height: 40px; background: var(--white); border: 1.5px solid var(--gray-200); border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .back-btn:active { transform: scale(0.93); }
        .back-btn svg { width: 18px; height: 18px; stroke: var(--gray-600); }
        .header-title { flex: 1; font-size: 17px; font-weight: 700; }
        .menu-btn { width: 36px; height: 36px; background: transparent; border: none; color: var(--gray-600); font-size: 20px; cursor: pointer; }
        
        /* Hero */
        .hero { margin: 20px 20px 16px; background: linear-gradient(135deg, var(--purple), var(--purple-dark)); border-radius: 24px; padding: 28px 24px; color: white; position: relative; overflow: hidden; }
        .hero::before { content: ''; position: absolute; top: -40%; right: -15%; width: 200px; height: 200px; background: rgba(255,255,255,0.08); border-radius: 50%; }
        .hero-inner { position: relative; z-index: 2; }
        .circle-name { font-size: 24px; font-weight: 800; margin-bottom: 8px; }
        .circle-meta { font-size: 13px; opacity: 0.8; margin-bottom: 20px; }
        .amount-big { font-size: 38px; font-weight: 800; margin-bottom: 4px; }
        .freq-label { font-size: 12px; opacity: 0.7; }
        
        /* Progress ring */
        .progress-section { padding: 0 20px 20px; }
        .progress-ring { width: 140px; height: 140px; margin: 0 auto 20px; position: relative; }
        .progress-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
        .progress-ring circle { fill: none; stroke-width: 12; }
        .bg-circle { stroke: var(--gray-200); }
        .fill-circle { stroke: var(--purple); stroke-linecap: round; transition: stroke-dashoffset 0.5s; }
        .progress-center { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .cycle-num { font-size: 28px; font-weight: 800; color: var(--gray-900); }
        .cycle-label { font-size: 11px; color: var(--gray-400); font-weight: 700; text-transform: uppercase; }
        
        /* Next card */
        .next-card { background: var(--white); border-radius: 16px; padding: 16px; margin-bottom: 20px; border: 1.5px solid var(--gray-200); }
        .next-label { font-size: 11px; font-weight: 700; color: var(--gray-400); text-transform: uppercase; margin-bottom: 8px; }
        .next-name { font-size: 16px; font-weight: 800; color: var(--gray-900); margin-bottom: 4px; }
        .next-date { font-size: 12px; color: var(--purple); font-weight: 600; }
        
        /* Section */
        .section { padding: 0 20px 20px; }
        .section-title { font-size: 15px; font-weight: 700; margin-bottom: 14px; }
        
        /* Member item */
        .member-item { display: flex; align-items: center; gap: 12px; padding: 14px 16px; background: var(--white); border-radius: 14px; margin-bottom: 10px; border: 1.5px solid var(--gray-200); }
        .member-avatar { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 15px; font-weight: 800; color: var(--white); flex-shrink: 0; }
        .member-info { flex: 1; }
        .member-name { font-size: 14px; font-weight: 700; color: var(--gray-900); }
        .member-pos { font-size: 12px; color: var(--gray-400); }
        .member-status { font-size: 11px; font-weight: 700; padding: 4px 10px; border-radius: 20px; }
        .status-paid { background: var(--green-light); color: var(--green-dark); }
        .status-pending { background: var(--amber-light); color: var(--amber); }
        .status-kicked { background: var(--red-light); color: var(--red); }
        
        /* Color classes */
        .c-0 { background: linear-gradient(135deg, #7c3aed, #6d28d9); }
        .c-1 { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .c-2 { background: linear-gradient(135deg, #059669, #047857); }
        .c-3 { background: linear-gradient(135deg, #d97706, #b45309); }
        .c-4 { background: linear-gradient(135deg, #dc2626, #b91c1c); }
        .c-5 { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        
        /* Leave button */
        .leave-btn { width: 100%; padding: 16px; background: var(--white); color: var(--red); border: 1.5px solid var(--red-light); border-radius: 16px; font-family: 'Sora'; font-size: 14px; font-weight: 700; cursor: pointer; margin-top: 20px; }
        .leave-btn:active { background: var(--red-light); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <button class="back-btn" onclick="window.history.back()">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 12H5M12 5l-7 7 7 7"/>
            </svg>
        </button>
        <span class="header-title" id="circleName">Weekend Fund</span>
        <button class="menu-btn" onclick="showMenu()">⋮</button>
    </div>

    <div class="hero">
        <div class="hero-inner">
            <div class="circle-name" id="heroName">Weekend Fund</div>
            <div class="circle-meta" id="heroMeta">8 members • Created Jan 15, 2026</div>
            <div class="amount-big" id="heroAmount">₦5,000</div>
            <div class="freq-label" id="heroFreq">Per week</div>
        </div>
    </div>

    <div class="progress-section">
        <div class="progress-ring">
            <svg>
                <circle class="bg-circle" cx="70" cy="70" r="60"/>
                <circle class="fill-circle" cx="70" cy="70" r="60" stroke-dasharray="377" stroke-dashoffset="141.375" id="progressCircle"/>
            </svg>
            <div class="progress-center">
                <div class="cycle-num" id="cycleNum">3/8</div>
                <div class="cycle-label">Cycles</div>
            </div>
        </div>

        <div class="next-card">
            <div class="next-label">Next Payout</div>
            <div class="next-name" id="nextName">Adaeze Nwosu</div>
            <div class="next-date" id="nextDate">Friday, Feb 21 • 4 days left</div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">Members & Payout Order</div>
        <div id="membersList"></div>
        
        <button class="leave-btn" onclick="leaveCircle()">Leave Circle</button>
    </div>
</div>

<script>
const API_BASE_URL = 'https://meritwise.app/api';

const mockCircle = {
    id: 'AJO-001',
    name: 'Weekend Fund',
    amount: 5000,
    frequency: 'weekly',
    members: 8,
    currentCycle: 3,
    totalCycles: 8,
    createdAt: '2026-01-15',
    nextPayout: { name: 'Adaeze Nwosu', date: '2026-02-21', daysLeft: 4 },
    memberList: [
        { name: 'Chioma Eze', id: 'PAY123', position: 1, status: 'paid', received: 40000, colorClass: 'c-0' },
        { name: 'Godwin Okafor', id: 'PAY456', position: 2, status: 'paid', received: 40000, colorClass: 'c-1' },
        { name: 'Adaeze Nwosu', id: 'PAY789', position: 3, status: 'pending', colorClass: 'c-2' },
        { name: 'You', id: 'PAY000', position: 4, status: 'pending', colorClass: 'c-3' },
        { name: 'Tobi Adeleke', id: 'PAY111', position: 5, status: 'pending', colorClass: 'c-4' },
        { name: 'Ngozi Obi', id: 'PAY222', position: 6, status: 'pending', colorClass: 'c-5' },
        { name: 'Emeka Chukwu', id: 'PAY333', position: 7, status: 'pending', colorClass: 'c-0' },
        { name: 'Amaka Nwankwo', id: 'PAY444', position: 8, status: 'pending', colorClass: 'c-1' }
    ]
};

document.addEventListener('DOMContentLoaded', () => {
    // API: GET /api/ajo/circle/:id
    loadCircle();
});

function loadCircle() {
    document.getElementById('circleName').textContent = mockCircle.name;
    document.getElementById('heroName').textContent = mockCircle.name;
    document.getElementById('heroMeta').textContent = `${mockCircle.members} members • Created ${new Date(mockCircle.createdAt).toLocaleDateString('en-NG')}`;
    document.getElementById('heroAmount').textContent = `₦${mockCircle.amount.toLocaleString('en-NG')}`;
    document.getElementById('heroFreq').textContent = `Per ${mockCircle.frequency}`;
    document.getElementById('cycleNum').textContent = `${mockCircle.currentCycle}/${mockCircle.totalCycles}`;
    document.getElementById('nextName').textContent = mockCircle.nextPayout.name;
    document.getElementById('nextDate').textContent = `${new Date(mockCircle.nextPayout.date).toLocaleDateString('en-NG', { weekday: 'long', month: 'short', day: 'numeric' })} • ${mockCircle.nextPayout.daysLeft} days left`;
    
    const progress = (mockCircle.currentCycle / mockCircle.totalCycles) * 377;
    document.getElementById('progressCircle').style.strokeDashoffset = 377 - progress;
    
    renderMembers();
}

function renderMembers() {
    const list = document.getElementById('membersList');
    list.innerHTML = mockCircle.memberList.map(m => {
        const statusClass = m.status === 'paid' ? 'status-paid' : m.status === 'kicked' ? 'status-kicked' : 'status-pending';
        const statusText = m.status === 'paid' ? '✓ Paid' : m.status === 'kicked' ? '❌ Removed' : '⏳ Pending';
        const subText = m.status === 'paid' ? `Received ₦${m.received.toLocaleString('en-NG')}` : 
                        m.position === mockCircle.currentCycle + 1 ? 'Receives next' : 
                        `${m.position - mockCircle.currentCycle} cycles away`;
        
        return `
            <div class="member-item">
                <div class="member-avatar ${m.colorClass}">${getInitials(m.name)}</div>
                <div class="member-info">
                    <div class="member-name">${m.name}</div>
                    <div class="member-pos">#${m.position} • ${subText}</div>
                </div>
                <span class="member-status ${statusClass}">${statusText}</span>
            </div>
        `;
    }).join('');
}

function getInitials(name) {
    return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
}

function showMenu() {
    alert('Menu options:\n• View Full History\n• Download Statement\n• Report Issue');
}

function leaveCircle() {
    if (confirm('⚠️ Leave this circle?\n\nYou'll forfeit your position and any future payout. This cannot be undone.')) {
        // API: POST /api/ajo/leave/:id
        alert('Left circle. Redirecting...');
        window.location.href = 'ajo-home.html';
    }
}
</script>
</body>
</html>
